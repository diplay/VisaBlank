#coding: utf-8
class UsersController < ApplicationController
<<<<<<< HEAD
  before_action :check_owner

  def index

=======
  before_action :check_owner, except: [:show, :change_password, :set_password]
  before_action :check_user, only: [:show, :change_password, :set_password]

  def index
    @users = User.all
>>>>>>> 08baddde40c516c39bcf72a4b7467b43f193fc22
  end

  def show
  end

<<<<<<< HEAD
=======
  def change_password
  end

  def set_password
    #TODO don't forget to send email
    if @_user.try(:authenticate, params[:user][:old_password])
      if @_user.update(password: params[:user][:password],
                   password_confirmation: params[:user][:password_confirmation])
        flash[:success] = "Пароль изменен"
        redirect_to user_path(@_user)
      else
        flash[:warning] = "Пароли не совпадают"
        redirect_to user_path(@_user)
      end
    else
      reset_session
      flash[:warning] = "Неверный пароль"
      redirect_to root_path
    end
  end

>>>>>>> 08baddde40c516c39bcf72a4b7467b43f193fc22
  def edit
  end

  private
  def check_owner
    unless @user.role == "admin" ||
      @user.id == params[:id]
      redirect_to root_path
    end
  end

<<<<<<< HEAD
=======
  def check_user
    @_user = User.find(params[:id])
    if @user.id != @_user.id
      redirect_to root_path
    end
  end

>>>>>>> 08baddde40c516c39bcf72a4b7467b43f193fc22
end
